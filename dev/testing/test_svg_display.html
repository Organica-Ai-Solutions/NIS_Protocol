<!DOCTYPE html>
<html>
<head>
    <title>SVG Display Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        img { max-width: 100%; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>üß™ SVG Display Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Direct SVG Chart Generation</h2>
        <button onclick="testDirectSVG()">Generate Direct SVG Chart</button>
        <div id="direct-svg-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Backend SVG Chart</h2>
        <button onclick="testBackendChart()">Fetch Backend Chart</button>
        <div id="backend-chart-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Backend Diagram</h2>
        <button onclick="testBackendDiagram()">Fetch Backend Diagram</button>
        <div id="backend-diagram-result"></div>
    </div>

    <script>
        function testDirectSVG() {
            const svg = `<svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="200" fill="#f8fafc" />
                <text x="200" y="30" style="font-family: Arial; font-size: 18px; font-weight: bold; text-anchor: middle;">Direct SVG Test</text>
                <rect x="50" y="60" width="80" height="100" fill="#3b82f6" />
                <rect x="160" y="40" width="80" height="120" fill="#10b981" />
                <rect x="270" y="80" width="80" height="80" fill="#f59e0b" />
                <text x="90" y="180" style="font-family: Arial; font-size: 12px; text-anchor: middle;">A</text>
                <text x="200" y="180" style="font-family: Arial; font-size: 12px; text-anchor: middle;">B</text>
                <text x="310" y="180" style="font-family: Arial; font-size: 12px; text-anchor: middle;">C</text>
            </svg>`;
            
            document.getElementById('direct-svg-result').innerHTML = `
                <h4>‚úÖ Direct SVG (should work):</h4>
                ${svg}
            `;
        }

        async function testBackendChart() {
            try {
                console.log('Testing backend chart...');
                const response = await fetch('/visualization/chart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chart_type: 'bar',
                        data: {
                            categories: ['Test A', 'Test B', 'Test C'],
                            values: [10, 20, 15],
                            title: 'Backend Chart Test'
                        },
                        style: 'scientific'
                    })
                });
                
                const result = await response.json();
                console.log('Backend response:', result);
                
                const chartUrl = result.chart?.url;
                if (chartUrl) {
                    document.getElementById('backend-chart-result').innerHTML = `
                        <h4>‚úÖ Backend Chart Response:</h4>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Format:</strong> ${result.chart.format}</p>
                        <p><strong>Method:</strong> ${result.chart.method}</p>
                        <p><strong>URL Length:</strong> ${chartUrl.length} characters</p>
                        <img src="${chartUrl}" alt="Backend Chart" style="border: 2px solid #059669;">
                        <details style="margin-top: 10px;">
                            <summary>üîç View Raw Data URL (click to expand)</summary>
                            <textarea readonly style="width: 100%; height: 100px; font-size: 10px;">${chartUrl}</textarea>
                        </details>
                    `;
                } else {
                    throw new Error('No chart URL in response');
                }
            } catch (error) {
                console.error('Backend chart test failed:', error);
                document.getElementById('backend-chart-result').innerHTML = `
                    <h4>‚ùå Backend Chart Test Failed:</h4>
                    <p style="color: red;">${error.message}</p>
                `;
            }
        }

        async function testBackendDiagram() {
            try {
                console.log('Testing backend diagram...');
                const response = await fetch('/visualization/diagram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        diagram_type: 'pipeline',
                        data: {
                            title: 'Backend Diagram Test'
                        },
                        style: 'scientific'
                    })
                });
                
                const result = await response.json();
                console.log('Backend diagram response:', result);
                
                const diagramUrl = result.diagram?.url;
                if (diagramUrl) {
                    document.getElementById('backend-diagram-result').innerHTML = `
                        <h4>‚úÖ Backend Diagram Response:</h4>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Format:</strong> ${result.diagram.format}</p>
                        <p><strong>Method:</strong> ${result.diagram.method}</p>
                        <p><strong>URL Length:</strong> ${diagramUrl.length} characters</p>
                        <img src="${diagramUrl}" alt="Backend Diagram" style="border: 2px solid #8b5cf6;">
                        <details style="margin-top: 10px;">
                            <summary>üîç View Raw Data URL (click to expand)</summary>
                            <textarea readonly style="width: 100%; height: 100px; font-size: 10px;">${diagramUrl}</textarea>
                        </details>
                    `;
                } else {
                    throw new Error('No diagram URL in response');
                }
            } catch (error) {
                console.error('Backend diagram test failed:', error);
                document.getElementById('backend-diagram-result').innerHTML = `
                    <h4>‚ùå Backend Diagram Test Failed:</h4>
                    <p style="color: red;">${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>